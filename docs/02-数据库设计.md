# Web3 CEX 数据库设计

## 1. 数据库设计原则

### 1.1 设计目标
- **数据一致性**: 强一致性保证
- **高性能**: 读写分离，分库分表
- **可扩展性**: 支持水平扩展
- **安全性**: 数据加密，访问控制
- **可维护性**: 规范化设计，便于维护

### 1.2 设计规范
- **命名规范**: 小写字母，下划线分隔
- **字段规范**: 明确类型，添加注释
- **索引规范**: 合理索引，避免过度索引
- **分表策略**: 按时间或业务ID分表

## 2. 数据库架构

### 2.1 整体架构
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                  应用层                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ 用户服务     │  │ 交易服务     │  │ 钱包服务     │  │ 财务服务     │             │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                  读写分离层                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                    Sharding-Jdbc + MyBatis Plus                              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                  数据库层                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  用户数据库  │  │  交易数据库  │  │  钱包数据库  │  │  财务数据库  │             │
│  │ user_db     │  │ trade_db    │  │ wallet_db   │  │ finance_db  │             │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  用户主库   │  │ 交易主库    │  │ 钱包主库    │  │ 财务主库    │             │
│  │ user_master │  │ trade_master│  │ wallet_master│  │ finance_master│            │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  用户从库   │  │ 交易从库    │  │ 钱包从库    │  │ 财务从库    │             │
│  │ user_slave  │  │ trade_slave │  │ wallet_slave │  │ finance_slave │            │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 分库分表策略
- **分库**: 按业务模块分库（用户、交易、钱包、财务）
- **分表**: 按时间或用户ID分表
- **读写分离**: 主库写入，从库读取
- **数据同步**: 主从复制，异步同步

## 3. 数据表设计

### 3.1 用户相关表

#### 3.1.1 用户基本信息表 (user_info)
```sql
CREATE TABLE `user_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `user_no` varchar(32) NOT NULL COMMENT '用户编号',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `email` varchar(100) NOT NULL COMMENT '邮箱',
  `phone` varchar(20) NOT NULL COMMENT '手机号',
  `password_hash` varchar(255) NOT NULL COMMENT '密码哈希',
  `salt` varchar(32) NOT NULL COMMENT '密码盐值',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-正常 2-冻结 3-注销',
  `kyc_status` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'KYC状态 0-未认证 1-已认证',
  `register_time` datetime NOT NULL COMMENT '注册时间',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` varchar(45) DEFAULT NULL COMMENT '最后登录IP',
  `google_auth_secret` varchar(32) DEFAULT NULL COMMENT 'Google认证密钥',
  `google_auth_enabled` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'Google认证启用',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `create_by` varchar(32) DEFAULT NULL COMMENT '创建人',
  `update_by` varchar(32) DEFAULT NULL COMMENT '更新人',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_no` (`user_no`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email` (`email`),
  UNIQUE KEY `uk_phone` (`phone`),
  KEY `idx_status` (`status`),
  KEY `idx_kyc_status` (`kyc_status`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户基本信息表';
```

#### 3.1.2 用户资产表 (user_asset)
```sql
CREATE TABLE `user_asset` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '资产ID',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `coin_id` varchar(32) NOT NULL COMMENT '币种ID',
  `coin_name` varchar(50) NOT NULL COMMENT '币种名称',
  `available_balance` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '可用余额',
  `frozen_balance` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '冻结余额',
  `total_balance` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '总余额',
  `address` varchar(255) DEFAULT NULL COMMENT '充值地址',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-正常 2-冻结',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_coin` (`user_id`, `coin_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_coin_id` (`coin_id`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_user_asset_user` FOREIGN KEY (`user_id`) REFERENCES `user_info` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户资产表';
```

#### 3.1.3 用户KYC表 (user_kyc)
```sql
CREATE TABLE `user_kyc` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'KYC ID',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `real_name` varchar(100) NOT NULL COMMENT '真实姓名',
  `id_card_type` varchar(20) NOT NULL COMMENT '证件类型',
  `id_card_no` varchar(50) NOT NULL COMMENT '证件号码',
  `id_card_front` varchar(255) NOT NULL COMMENT '身份证正面照片',
  `id_card_back` varchar(255) NOT NULL COMMENT '身份证背面照片',
  `id_card_hand` varchar(255) DEFAULT NULL COMMENT '手持身份证照片',
  `nationality` varchar(50) NOT NULL COMMENT '国籍',
  `address` varchar(255) NOT NULL COMMENT '地址',
  `status` tinyint(1) NOT NULL DEFAULT '0' COMMENT '状态 0-待审核 1-已通过 2-已拒绝',
  `audit_time` datetime DEFAULT NULL COMMENT '审核时间',
  `audit_user` varchar(32) DEFAULT NULL COMMENT '审核人',
  `reject_reason` varchar(500) DEFAULT NULL COMMENT '拒绝原因',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_id_card_no` (`id_card_no`),
  CONSTRAINT `fk_user_kyc_user` FOREIGN KEY (`user_id`) REFERENCES `user_info` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户KYC表';
```

### 3.2 交易相关表

#### 3.2.1 交易对配置表 (trade_pair)
```sql
CREATE TABLE `trade_pair` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '交易对ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对符号',
  `base_coin` varchar(32) NOT NULL COMMENT '基础币种',
  `quote_coin` varchar(32) NOT NULL COMMENT '计价币种',
  `pair_name` varchar(50) NOT NULL COMMENT '交易对名称',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-正常 2-暂停',
  `price_precision` int(11) NOT NULL DEFAULT '8' COMMENT '价格精度',
  `amount_precision` int(11) NOT NULL DEFAULT '8' COMMENT '数量精度',
  `min_amount` decimal(20,8) NOT NULL DEFAULT '0.00000001' COMMENT '最小数量',
  `max_amount` decimal(20,8) NOT NULL DEFAULT '1000000.00000000' COMMENT '最大数量',
  `min_price` decimal(20,8) NOT NULL DEFAULT '0.00000001' COMMENT '最小价格',
  `max_price` decimal(20,8) NOT NULL DEFAULT '1000000.00000000' COMMENT '最大价格',
  `fee_rate` decimal(10,6) NOT NULL DEFAULT '0.001000' COMMENT '手续费率',
  `sort_order` int(11) NOT NULL DEFAULT '0' COMMENT '排序',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_symbol` (`symbol`),
  KEY `idx_status` (`status`),
  KEY `idx_base_coin` (`base_coin`),
  KEY `idx_quote_coin` (`quote_coin`),
  KEY `idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='交易对配置表';
```

#### 3.2.2 订单表 (trade_order)
```sql
CREATE TABLE `trade_order` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `order_no` varchar(32) NOT NULL COMMENT '订单编号',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `order_type` tinyint(1) NOT NULL COMMENT '订单类型 1-限价单 2-市价单',
  `direction` tinyint(1) NOT NULL COMMENT '买卖方向 1-买入 2-卖出',
  `price` decimal(20,8) NOT NULL COMMENT '价格',
  `amount` decimal(20,8) NOT NULL COMMENT '数量',
  `executed_amount` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '已成交数量',
  `executed_value` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '已成交金额',
  `fee` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '手续费',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-待成交 2-部分成交 3-完全成交 4-已取消',
  `time_in_force` tinyint(1) NOT NULL DEFAULT '1' COMMENT '时效类型 1-GTC 2-IOC 3-FOK',
  `source` tinyint(1) NOT NULL DEFAULT '1' COMMENT '来源 1-Web 2-API 3-App',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `cancel_time` datetime DEFAULT NULL COMMENT '取消时间',
  `expire_time` datetime DEFAULT NULL COMMENT '过期时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_status` (`status`),
  KEY `idx_order_type` (`order_type`),
  KEY `idx_direction` (`direction`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_price` (`price`),
  KEY `idx_expire_time` (`expire_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

#### 3.2.3 成交明细表 (trade_detail)
```sql
CREATE TABLE `trade_detail` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '成交ID',
  `trade_no` varchar(32) NOT NULL COMMENT '成交编号',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `maker_order_id` bigint(20) NOT NULL COMMENT 'Maker订单ID',
  `taker_order_id` bigint(20) NOT NULL COMMENT 'Taker订单ID',
  `maker_user_id` bigint(20) NOT NULL COMMENT 'Maker用户ID',
  `taker_user_id` bigint(20) NOT NULL COMMENT 'Taker用户ID',
  `price` decimal(20,8) NOT NULL COMMENT '成交价格',
  `amount` decimal(20,8) NOT NULL COMMENT '成交数量',
  `value` decimal(20,8) NOT NULL COMMENT '成交金额',
  `maker_fee` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT 'Maker手续费',
  `taker_fee` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT 'Taker手续费',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '成交时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_trade_no` (`trade_no`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_maker_order_id` (`maker_order_id`),
  KEY `idx_taker_order_id` (`taker_order_id`),
  KEY `idx_maker_user_id` (`maker_user_id`),
  KEY `idx_taker_user_id` (`taker_user_id`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_price` (`price`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='成交明细表';
```

### 3.3 钱包相关表

#### 3.3.1 钱包地址表 (wallet_address)
```sql
CREATE TABLE `wallet_address` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '地址ID',
  `coin_id` varchar(32) NOT NULL COMMENT '币种ID',
  `coin_name` varchar(50) NOT NULL COMMENT '币种名称',
  `address_type` tinyint(1) NOT NULL COMMENT '地址类型 1-热钱包 2-冷钱包',
  `address` varchar(255) NOT NULL COMMENT '钱包地址',
  `private_key` varchar(500) NOT NULL COMMENT '私钥(加密存储)',
  `public_key` varchar(255) DEFAULT NULL COMMENT '公钥',
  `mnemonic` varchar(500) DEFAULT NULL COMMENT '助记词(加密存储)',
  `wallet_type` varchar(50) NOT NULL COMMENT '钱包类型',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-正常 2-停用',
  `balance` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '余额',
  `min_balance` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '最小余额',
  `max_balance` decimal(20,8) NOT NULL DEFAULT '1000000.00000000' COMMENT '最大余额',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_address` (`address`),
  KEY `idx_coin_id` (`coin_id`),
  KEY `idx_address_type` (`address_type`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='钱包地址表';
```

#### 3.3.2 充值记录表 (recharge_record)
```sql
CREATE TABLE `recharge_record` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '充值ID',
  `recharge_no` varchar(32) NOT NULL COMMENT '充值编号',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `coin_id` varchar(32) NOT NULL COMMENT '币种ID',
  `coin_name` varchar(50) NOT NULL COMMENT '币种名称',
  `tx_hash` varchar(255) NOT NULL COMMENT '交易哈希',
  `from_address` varchar(255) NOT NULL COMMENT '来源地址',
  `to_address` varchar(255) NOT NULL COMMENT '目标地址',
  `amount` decimal(20,8) NOT NULL COMMENT '充值数量',
  `confirmations` int(11) NOT NULL DEFAULT '0' COMMENT '确认数',
  `required_confirmations` int(11) NOT NULL DEFAULT '6' COMMENT '需要确认数',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-待确认 2-已确认 3-已失败',
  `fee` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '手续费',
  `block_number` bigint(20) DEFAULT NULL COMMENT '区块号',
  `block_time` datetime DEFAULT NULL COMMENT '区块时间',
  `memo` varchar(255) DEFAULT NULL COMMENT '备注',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `confirm_time` datetime DEFAULT NULL COMMENT '确认时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_recharge_no` (`recharge_no`),
  UNIQUE KEY `uk_tx_hash` (`tx_hash`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_coin_id` (`coin_id`),
  KEY `idx_status` (`status`),
  KEY `idx_to_address` (`to_address`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='充值记录表';
```

#### 3.3.3 提现记录表 (withdraw_record)
```sql
CREATE TABLE `withdraw_record` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '提现ID',
  `withdraw_no` varchar(32) NOT NULL COMMENT '提现编号',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `coin_id` varchar(32) NOT NULL COMMENT '币种ID',
  `coin_name` varchar(50) NOT NULL COMMENT '币种名称',
  `to_address` varchar(255) NOT NULL COMMENT '目标地址',
  `amount` decimal(20,8) NOT NULL COMMENT '提现数量',
  `fee` decimal(20,8) NOT NULL COMMENT '手续费',
  `actual_amount` decimal(20,8) NOT NULL COMMENT '实际到账数量',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-待审核 2-已通过 3-已拒绝 4-处理中 5-已完成 6-已失败',
  `tx_hash` varchar(255) DEFAULT NULL COMMENT '交易哈希',
  `confirmations` int(11) DEFAULT '0' COMMENT '确认数',
  `required_confirmations` int(11) NOT NULL DEFAULT '6' COMMENT '需要确认数',
  `audit_user` varchar(32) DEFAULT NULL COMMENT '审核人',
  `audit_time` datetime DEFAULT NULL COMMENT '审核时间',
  `audit_remark` varchar(500) DEFAULT NULL COMMENT '审核备注',
  `block_number` bigint(20) DEFAULT NULL COMMENT '区块号',
  `block_time` datetime DEFAULT NULL COMMENT '区块时间',
  `memo` varchar(255) DEFAULT NULL COMMENT '备注',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `complete_time` datetime DEFAULT NULL COMMENT '完成时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_withdraw_no` (`withdraw_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_coin_id` (`coin_id`),
  KEY `idx_status` (`status`),
  KEY `idx_tx_hash` (`tx_hash`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='提现记录表';
```

### 3.4 财务相关表

#### 3.4.1 资金流水表 (financial_flow)
```sql
CREATE TABLE `financial_flow` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '流水ID',
  `flow_no` varchar(32) NOT NULL COMMENT '流水编号',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `coin_id` varchar(32) NOT NULL COMMENT '币种ID',
  `coin_name` varchar(50) NOT NULL COMMENT '币种名称',
  `business_type` tinyint(1) NOT NULL COMMENT '业务类型 1-充值 2-提现 3-买入 4-卖出 5-手续费 6-其他',
  `amount` decimal(20,8) NOT NULL COMMENT '金额',
  `balance_before` decimal(20,8) NOT NULL COMMENT '操作前余额',
  `balance_after` decimal(20,8) NOT NULL COMMENT '操作后余额',
  `fee` decimal(20,8) NOT NULL DEFAULT '0.00000000' COMMENT '手续费',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态 1-成功 2-失败',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `ref_order_no` varchar(32) DEFAULT NULL COMMENT '关联订单号',
  `ref_tx_hash` varchar(255) DEFAULT NULL COMMENT '关联交易哈希',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_flow_no` (`flow_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_coin_id` (`coin_id`),
  KEY `idx_business_type` (`business_type`),
  KEY `idx_status` (`status`),
  KEY `idx_ref_order_no` (`ref_order_no`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='资金流水表';
```

## 4. 数据库配置

### 4.1 主库配置
```ini
[mysql-master]
server-id = 1
log-bin = mysql-bin
binlog-format = ROW
expire_logs_days = 7
max_connections = 1000
innodb_buffer_pool_size = 4G
innodb_log_file_size = 1G
innodb_flush_log_at_trx_commit = 1
```

### 4.2 从库配置
```ini
[mysql-slave]
server-id = 2
relay-log = mysql-relay-bin
read-only = 1
max_connections = 2000
innodb_buffer_pool_size = 8G
```

### 4.3 连接池配置
```yaml
spring:
  datasource:
    master:
      url: jdbc:mysql://mysql-master:3306/user_db?useSSL=false&characterEncoding=utf8
      username: root
      password: password
      driver-class-name: com.mysql.cj.jdbc.Driver
      hikari:
        maximum-pool-size: 20
        minimum-idle: 10
        connection-timeout: 30000
        idle-timeout: 600000
        max-lifetime: 1800000
    slave:
      url: jdbc:mysql://mysql-slave:3306/user_db?useSSL=false&characterEncoding=utf8
      username: root
      password: password
      driver-class-name: com.mysql.cj.jdbc.Driver
      hikari:
        maximum-pool-size: 30
        minimum-idle: 15
        connection-timeout: 30000
        idle-timeout: 600000
        max-lifetime: 1800000
```

## 5. 性能优化

### 5.1 索引优化
- **主键索引**: 所有表设置主键
- **唯一索引**: 业务唯一字段
- **普通索引**: 查询条件字段
- **复合索引**: 多字段查询条件

### 5.2 查询优化
- **避免全表扫描**: 使用索引
- **避免大结果集**: 分页查询
- **避免复杂查询**: 拆分复杂查询
- **使用缓存**: 热点数据缓存

### 5.3 分库分表
- **水平分表**: 按时间或用户ID分表
- **垂直分库**: 按业务模块分库
- **读写分离**: 主库写入，从库读取
- **数据归档**: 历史数据归档存储

## 6. 数据安全

### 6.1 数据加密
- **敏感字段加密**: 手机号、邮箱等
- **密码加密**: BCrypt哈希加密
- **传输加密**: HTTPS传输
- **存储加密**: 数据库加密

### 6.2 访问控制
- **最小权限原则**: 按需分配权限
- **访问审计**: 记录访问日志
- **IP白名单**: 限制访问IP
- **连接数限制**: 防止连接过多

### 6.3 数据备份
- **定时备份**: 每日全量备份
- **增量备份**: 实时增量备份
- **异地备份**: 跨地域备份
- **恢复测试**: 定期恢复测试