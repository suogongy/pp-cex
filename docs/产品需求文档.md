# 简化版Web3中心化交易所(CEX)产品需求文档

## 1. 项目概述

### 1.1 项目背景
本项目是一个学习型的Web3中心化交易所(CEX)系统，旨在帮助开发者掌握CEX系统的核心概念和实现原理。项目采用简化的架构，保留核心功能，适合学习和实践。

### 1.2 项目目标
- 理解CEX系统的核心功能和架构
- 掌握区块链资产交易的基本原理
- 学习高并发交易系统的设计模式
- 实践Spring Cloud Alibaba和现代前端技术栈

### 1.3 技术选型
- **后端**: Spring Boot + Spring Cloud Alibaba + MyBatis Plus + Redis + MySQL + RocketMQ
- **前端**: Next.js 15 + TypeScript + Tailwind CSS + Ant Design
- **区块链**: wagmi + MetaMask集成
- **部署**: Docker + Docker Compose

## 2. 核心功能模块

### 2.1 用户系统
#### 2.1.1 注册登录
- 手机号/邮箱注册
- Google 2FA验证
- KYC基础认证（简化版）
- JWT Token认证
- 风控IP限制

#### 2.1.2 用户资产管理
- 多币种资产管理
- 充值地址生成
- 提现审核流程
- 资产冻结/解冻
- 资产流水记录

### 2.2 交易系统
#### 2.2.1 交易市场
- 币币交易（BTC/USDT, ETH/USDT等主流交易对）
- 实时行情显示
- K线图表展示
- 市场深度图
- 最新成交记录

#### 2.2.2 订单管理
- 限价单/市价单
- 止盈止损单
- 订单生命周期管理（待成交、部分成交、已成交、已取消）
- 订单历史查询
- 实时成交通知

#### 2.2.3 撮合引擎
- 简化版价格时间优先算法
- 内存数据库匹配
- 实时推送成交结果
- 交易手续费计算

### 2.3 钱包系统
#### 2.3.1 热钱包管理
- 多币种热钱包
- 自动充值检测
- 提现审核机制
- 热钱包余额监控

#### 2.3.2 冷钱包管理（暂时不用实现）
- 冷钱包地址管理
- 资金调度策略
- 多重签名验证
- 资产安全策略

### 2.4 财务系统
#### 2.4.1 财务管理
- 资金流水记录
- 充值提现管理
- 手续费收入统计
- 财务报表生成

#### 2.4.2 风控系统
- 异常交易监控
- 大额交易审核
- 反洗钱(AML)基础规则
- 用户行为分析

## 3. 技术架构设计

### 3.1 系统架构
```
┌─────────────────────────────────────────────────────────────┐
│                      前端应用层                              │
│  Next.js + TypeScript + Tailwind CSS + Ant Design          │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      API网关层                              │
│           Spring Cloud Gateway + Nacos + Sentinel           │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      微服务层                               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │ 用户服务     │ │ 交易服务     │ │ 钱包服务     │ │ 财务服务 │ │
│  │User Service │ │Trade Service│ │Wallet Service│ │Finance  │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      基础设施层                             │
│  MySQL + Redis + RocketMQ + Nacos + Sentinel + Seata        │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 核心技术栈
- **微服务框架**: Spring Cloud Alibaba 2022.x
- **服务注册发现**: Nacos 2.2.x
- **配置管理**: Nacos Config
- **服务网关**: Spring Cloud Gateway
- **熔断限流**: Sentinel
- **分布式事务**: Seata
- **消息队列**: RocketMQ 4.9.x
- **缓存**: Redis 7.x
- **数据库**: MySQL 8.0
- **ORM框架**: MyBatis Plus
- **区块链交互**: wagmi

**RocketMQ核心特性：**
- **事务消息**: 保证订单创建和资产变动的一致性
- **顺序消息**: 确保用户资产变动顺序性
- **延迟消息**: 支持订单超时取消、提现审核超时
- **消息轨迹**: 完整的消息追踪和审计链

### 3.3 数据库设计
#### 3.3.1 用户相关表
- `user_info`: 用户基本信息
- `user_asset`: 用户资产信息
- `user_kyc`: 用户KYC信息
- `user_login_log`: 用户登录日志

#### 3.3.2 交易相关表
- `trade_pair`: 交易对配置
- `trade_order`: 订单信息
- `trade_detail`: 成交明细
- `trade_fee`: 手续费记录

#### 3.3.3 钱包相关表
- `wallet_address`: 钱包地址管理
- `recharge_record`: 充值记录
- `withdraw_record`: 提现记录
- `wallet_transfer`: 钱包内部转账

#### 3.3.4 财务相关表
- `financial_flow`: 资金流水
- `financial_daily_report`: 日报表
- `risk_control`: 风控规则

## 4. 功能规格说明

### 4.1 用户端功能
#### 4.1.1 首页
- 市场行情概览
- 热门交易对
- 24小时涨跌幅
- 最新公告

#### 4.1.2 交易页面
- 实时价格显示
- K线图表（TradingView简化版）
- 买卖盘口深度
- 订单簿
- 下单表单
- 持仓管理

#### 4.1.3 资产管理
- 总资产概览
- 币种资产明细
- 充值功能
- 提现功能
- 资产流水

#### 4.1.4 订单管理
- 当前委托
- 历史委托
- 成交记录
- 条件单

#### 4.1.5 个人中心
- 基本信息
- 安全设置
- KYC认证
- API管理

### 4.2 管理端功能
#### 4.2.1 仪表盘
- 系统概览
- 交易统计
- 用户统计
- 收入统计

#### 4.2.2 用户管理
- 用户列表
- 用户详情
- 资产管理
- 冻结/解冻

#### 4.2.3 交易管理
- 交易对配置
- 手续费设置
- 订单查询
- 异常订单处理

#### 4.2.4 财务管理
- 充值审核
- 提现审核
- 资金流水
- 财务报表

#### 4.2.5 风控管理
- 风险规则配置
- 异常监控
- IP黑名单
- 交易限制

#### 4.2.6 系统设置
- 系统参数
- 公告管理
- 操作日志

## 5. 安全设计

### 5.1 资产安全
- 多重签名钱包
- 冷热钱包分离
- 提现审核机制
- 资产实时监控
- **RocketMQ事务消息**: 保证资产变动原子性
- **顺序消息**: 确保用户资产变动顺序一致性

### 5.2 系统安全
- JWT Token认证
- API接口签名
- 防SQL注入
- 防XSS攻击
- 防CSRF攻击

### 5.3 风控策略
- 交易频率限制
- 大额交易审核
- 异常IP监控
- 用户行为分析

## 6. 性能指标

### 6.1 系统性能
- 订单处理延迟: < 100ms
- 并发用户数: 10,000+
- 系统可用性: 99.9%
- 数据一致性: 强一致性
- **消息处理能力**: 单机10万+ TPS
- **消息延迟**: 毫秒级响应

### 6.2 业务指标
- 支持交易对: 10+
- 日交易量: 100万笔
- 支持币种: 20+
- 充值确认时间: 5-30分钟

## 7. 项目里程碑

### Phase 1: 基础架构搭建 (2周)
- 环境搭建
- 基础框架搭建
- 数据库设计
- 用户认证系统

### Phase 2: 核心交易功能 (3周)
- 交易市场
- 订单管理
- 撮合引擎
- 实时行情

### Phase 3: 钱包系统 (2周)
- 钱包管理
- 充值功能
- 提现功能
- 资产管理

### Phase 4: 财务风控 (2周)
- 财务系统
- 风控系统
- 管理后台
- 数据统计

### Phase 5: 优化部署 (1周)
- 性能优化
- 安全加固
- 部署上线
- 文档完善

## 8. 学习重点

### 8.1 技术学习
- 微服务架构设计
- 高并发交易系统
- 分布式事务处理
- 区块链集成

### 8.2 业务学习
- 交易所业务模式
- 资产安全管理
- 风控策略制定
- 财务合规要求

### 8.3 实践重点
- 系统架构设计
- 核心算法实现
- 性能优化技巧
- 安全防护措施

## 9. 风险评估

### 9.1 技术风险
- 高并发处理能力
- 数据一致性保证
- 系统稳定性

### 9.2 业务风险
- 资产安全管理
- 合规性要求
- 用户体验

### 9.3 安全风险
- 资产盗用风险
- 系统攻击风险
- 内部操作风险

## 10. 项目交付物

### 10.1 代码交付
- 完整源代码
- 数据库脚本
- 部署脚本
- 测试用例

### 10.2 文档交付
- 技术文档
- API文档
- 部署文档
- 用户手册