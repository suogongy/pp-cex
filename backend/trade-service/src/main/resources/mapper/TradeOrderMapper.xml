<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cex.trade.mapper.TradeOrderMapper">

    <resultMap id="OrderVOMap" type="com.cex.trade.dto.OrderVO">
        <id column="id" property="id"/>
        <result column="order_no" property="orderNo"/>
        <result column="user_id" property="userId"/>
        <result column="symbol" property="symbol"/>
        <result column="pair_name" property="pairName"/>
        <result column="order_type" property="orderType"/>
        <result column="direction" property="direction"/>
        <result column="price" property="price"/>
        <result column="amount" property="amount"/>
        <result column="executed_amount" property="executedAmount"/>
        <result column="executed_value" property="executedValue"/>
        <result column="fee" property="fee"/>
        <result column="status" property="status"/>
        <result column="time_in_force" property="timeInForce"/>
        <result column="source" property="source"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="cancel_time" property="cancelTime"/>
        <result column="expire_time" property="expireTime"/>
    </resultMap>

    <select id="selectOrderVOPage" resultMap="OrderVOMap">
        SELECT
            o.id, o.order_no, o.user_id, o.symbol, tp.pair_name,
            o.order_type, o.direction, o.price, o.amount, o.executed_amount,
            o.executed_value, o.fee, o.status, o.time_in_force, o.source,
            o.create_time, o.update_time, o.cancel_time, o.expire_time
        FROM trade_order o
        LEFT JOIN trade_pair tp ON o.symbol = tp.symbol
        <where>
            <if test="userId != null">
                AND o.user_id = #{userId}
            </if>
            <if test="symbol != null and symbol != ''">
                AND o.symbol = #{symbol}
            </if>
            <if test="status != null">
                AND o.status = #{status}
            </if>
            <if test="orderType != null">
                AND o.order_type = #{orderType}
            </if>
        </where>
        ORDER BY o.create_time DESC
    </select>

    <select id="selectOrderVOByOrderNo" resultMap="OrderVOMap">
        SELECT
            o.id, o.order_no, o.user_id, o.symbol, tp.pair_name,
            o.order_type, o.direction, o.price, o.amount, o.executed_amount,
            o.executed_value, o.fee, o.status, o.time_in_force, o.source,
            o.create_time, o.update_time, o.cancel_time, o.expire_time
        FROM trade_order o
        LEFT JOIN trade_pair tp ON o.symbol = tp.symbol
        WHERE o.order_no = #{orderNo}
    </select>

    <select id="selectActiveOrdersBySymbol" resultMap="OrderVOMap">
        SELECT
            o.id, o.order_no, o.user_id, o.symbol, tp.pair_name,
            o.order_type, o.direction, o.price, o.amount, o.executed_amount,
            o.executed_value, o.fee, o.status, o.time_in_force, o.source,
            o.create_time, o.update_time, o.cancel_time, o.expire_time
        FROM trade_order o
        LEFT JOIN trade_pair tp ON o.symbol = tp.symbol
        WHERE o.symbol = #{symbol} AND o.status IN (1, 2)
        ORDER BY o.price ASC, o.create_time ASC
    </select>

    <select id="selectUserActiveOrders" resultMap="OrderVOMap">
        SELECT
            o.id, o.order_no, o.user_id, o.symbol, tp.pair_name,
            o.order_type, o.direction, o.price, o.amount, o.executed_amount,
            o.executed_value, o.fee, o.status, o.time_in_force, o.source,
            o.create_time, o.update_time, o.cancel_time, o.expire_time
        FROM trade_order o
        LEFT JOIN trade_pair tp ON o.symbol = tp.symbol
        WHERE o.user_id = #{userId} AND o.status IN (1, 2)
        ORDER BY o.create_time DESC
    </select>

</mapper>