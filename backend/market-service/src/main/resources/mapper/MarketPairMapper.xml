<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ppcex.market.mapper.MarketPairMapper">

    <resultMap id="MarketPairVOResultMap" type="com.ppcex.market.dto.MarketPairVO">
        <id property="id" column="id"/>
        <result property="symbol" column="symbol"/>
        <result property="baseCoin" column="base_coin"/>
        <result property="quoteCoin" column="quote_coin"/>
        <result property="pairName" column="pair_name"/>
        <result property="status" column="status"/>
        <result property="statusName" column="status_name"/>
        <result property="pricePrecision" column="price_precision"/>
        <result property="amountPrecision" column="amount_precision"/>
        <result property="minAmount" column="min_amount"/>
        <result property="maxAmount" column="max_amount"/>
        <result property="minPrice" column="min_price"/>
        <result property="maxPrice" column="max_price"/>
        <result property="feeRate" column="fee_rate"/>
        <result property="sortOrder" column="sort_order"/>
    </resultMap>

    <select id="getMarketPairPage" resultMap="MarketPairVOResultMap">
        SELECT
            mp.*,
            CASE mp.status
                WHEN 1 THEN '正常'
                WHEN 2 THEN '暂停'
                ELSE '未知'
            END as status_name
        FROM market_pair mp
        <where>
            <if test="symbol != null and symbol != ''">
                AND mp.symbol LIKE CONCAT('%', #{symbol}, '%')
            </if>
            <if test="status != null">
                AND mp.status = #{status}
            </if>
        </where>
        ORDER BY mp.sort_order ASC, mp.create_time DESC
    </select>

    <select id="getActiveMarketPairs" resultMap="MarketPairVOResultMap">
        SELECT
            mp.*,
            CASE mp.status
                WHEN 1 THEN '正常'
                WHEN 2 THEN '暂停'
                ELSE '未知'
            END as status_name
        FROM market_pair mp
        WHERE mp.status = 1
        ORDER BY mp.sort_order ASC, mp.create_time DESC
    </select>

    <select id="getMarketPairBySymbol" resultMap="MarketPairVOResultMap">
        SELECT
            mp.*,
            CASE mp.status
                WHEN 1 THEN '正常'
                WHEN 2 THEN '暂停'
                ELSE '未知'
            END as status_name
        FROM market_pair mp
        WHERE mp.symbol = #{symbol}
    </select>

    <select id="getMarketPairById" resultMap="MarketPairVOResultMap">
        SELECT
            mp.*,
            CASE mp.status
                WHEN 1 THEN '正常'
                WHEN 2 THEN '暂停'
                ELSE '未知'
            END as status_name
        FROM market_pair mp
        WHERE mp.id = #{id}
    </select>

</mapper>